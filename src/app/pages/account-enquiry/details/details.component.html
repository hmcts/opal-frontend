{{ stateService.error().message }}

@if (data$ | async; as data) {
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-l">Account</h1>
      <p class="govuk-body"><span class="govuk-!-font-weight-bold">Account in</span> {{ data.accountCT }}</p>
      <p class="govuk-body">
        <span class="govuk-!-font-weight-bold">A/C No</span> {{ data.accountNumber }}
        <span class="govuk-!-font-weight-bold govuk-!-margin-left-5">Name</span> {{ data.fullName }}
      </p>
    </div>
  </div>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <app-govuk-tabs tabsId="tabsAccount">
        <ng-container items>
          <app-govuk-tab-list-item
            tabsId="tabsAccount"
            tabsListItemId="listItemAccountDetails"
            tabListItemHref="#tabsAccountPanelAccountDetails"
            tabListItemName="Details"
          ></app-govuk-tab-list-item>
          <app-govuk-tab-list-item
            tabsId="tabsAccount"
            tabsListItemId="listItemAccountImposition"
            tabListItemHref="#tabsAccountPanelAccountImposition"
            tabListItemName="Imposition"
          ></app-govuk-tab-list-item>
          <app-govuk-tab-list-item
            tabsId="tabsAccount"
            tabsListItemId="listItemAccountHistory"
            tabListItemHref="#tabsAccountPanelAccountHistory"
            tabListItemName="History"
          ></app-govuk-tab-list-item>
        </ng-container>
        <ng-container panels>
          <app-govuk-tab-panel tabsId="tabsAccount" tabsPanelId="panelAccountDetails">
            <h2 class="govuk-heading-m">Account Details</h2>
            <app-govuk-summary-list summaryListId="summaryListAccountDetails">
              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowAddress"
              >
                <ng-container name>Address</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.address }}</p></ng-container
                >
              </div>
              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowPostcode"
              >
                <ng-container name>Postcode</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.postCode }}</p></ng-container
                >
              </div>

              <div app-govuk-summary-list-row summaryListId="summaryListAccountDetails" summaryListRowId="listRowDob">
                <ng-container name>Date of Birth</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.dob }}</p></ng-container
                >
              </div>

              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowDetailsChanged"
              >
                <ng-container name>Details Changed</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.detailsChanged }}</p></ng-container
                >
              </div>

              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="lastCourtAppAndCourtCode"
              >
                <ng-container name>Last Court App</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.lastCourtAppAndCourtCode }}</p></ng-container
                >
              </div>

              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowLastMovement"
              >
                <ng-container name>Last Court Movement</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.lastMovement }}</p></ng-container
                >
              </div>

              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowCommentField"
              >
                <ng-container name>Comment Field</ng-container>
                <ng-container value>
                  @for (comment of data.commentField; track $index) {
                    <p class="govuk-body">{{ comment }}</p>
                  }
                </ng-container>
              </div>

              <div app-govuk-summary-list-row summaryListId="summaryListAccountDetails" summaryListRowId="listRowPcr">
                <ng-container name>PCR</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.pcr }}</p></ng-container
                >
              </div>

              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowPaymentDetails"
              >
                <ng-container name>Payment Details</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.paymentDetails }}</p></ng-container
                >
              </div>

              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowCommencing"
              >
                <ng-container name>Commencing</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.commencing }}</p></ng-container
                >
              </div>

              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowDaysInDefault"
              >
                <ng-container name>Days in Default</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.daysInDefault }}</p></ng-container
                >
              </div>

              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowOffenceDate"
              >
                <ng-container name>Offence Date</ng-container>
                <ng-container value><p class="govuk-body"></p></ng-container>
              </div>
              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowOffenceDate"
              >
                <ng-container name>Police Force/CTO</ng-container>
                <ng-container value><p class="govuk-body"></p></ng-container>
              </div>
              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowLastEnforcement"
              >
                <ng-container name>Last Enforcement</ng-container>
                <ng-container value
                  ><p class="govuk-body">{{ data.lastEnforcement }}</p></ng-container
                >
              </div>
              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowOverride"
              >
                <ng-container name>Override</ng-container>
                <ng-container value
                  ><p class="govuk-body">
                    {{ data.override }}
                  </p></ng-container
                >
              </div>
              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowEnforcer"
              >
                <ng-container name>Enforcer</ng-container>
                <ng-container value
                  ><p class="govuk-body">
                    {{ data.enforcer }}
                  </p></ng-container
                >
              </div>
              <div
                app-govuk-summary-list-row
                summaryListId="summaryListAccountDetails"
                summaryListRowId="listRowEnforcementCourt"
              >
                <ng-container name>Enforcement Court</ng-container>
                <ng-container value
                  ><p class="govuk-body">
                    {{ data.enforcementCourt }}
                  </p></ng-container
                >
              </div>
              <div app-govuk-summary-list-row summaryListId="accountDetails" summaryListRowId="listRowImposed">
                <ng-container name>Imposed</ng-container>
                <ng-container value
                  ><p class="govuk-body">
                    {{ data.imposed | currency: 'GBP' : 'symbol' }}
                  </p></ng-container
                >
              </div>
              <div app-govuk-summary-list-row summaryListId="accountDetails" summaryListRowId="listRowAmountPaid">
                <ng-container name>Paid so Far</ng-container>
                <ng-container value
                  ><p class="govuk-body">
                    {{ data.amountPaid | currency: 'GBP' : 'symbol' }}
                  </p></ng-container
                >
              </div>

              <div app-govuk-summary-list-row summaryListId="accountDetails" summaryListRowId="listRowBalance">
                <ng-container name>Balance</ng-container>
                <ng-container value
                  ><p class="govuk-body">
                    {{ data.balance | currency: 'GBP' : 'symbol' }}
                  </p></ng-container
                >
              </div>
            </app-govuk-summary-list>
          </app-govuk-tab-panel>
          <app-govuk-tab-panel tabsId="tabsAccount" tabsPanelId="panelAccountImposition">
            <h2 class="govuk-heading-m">Imposition</h2></app-govuk-tab-panel
          ><app-govuk-tab-panel tabsId="tabsAccount" tabsPanelId="panelAccountHistory">
            <h2 class="govuk-heading-m">History</h2>
            @if (stateService.featureFlags()['add-note'] !== false) {
              {{ permissions['addNote'] }}

              <form (submit)="handleNotesFormSubmit()">
                <ng-container [formGroup]="addNoteForm">
                  <app-govuk-text-input
                    labelText="Add a note"
                    inputId="note"
                    inputName="surname"
                    inputClasses="govuk-!-full-width"
                    [control]="addNoteForm.controls['note']"
                  ></app-govuk-text-input>

                  <div class="govuk-grid-row">
                    <div class="govuk-grid-column-full clearfix">
                      <span class="pull-right">
                        <app-govuk-button buttonId="submitForm" type="submit"> Add</app-govuk-button>
                      </span>
                    </div>
                  </div>
                </ng-container>
              </form>

              <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible" />
            }
            @if (notes$ | async; as data) {
              @for (note of data; track note.noteId) {
                <app-govuk-inset-text [insetTextId]="'insetText' + note.noteId">
                  {{ note.noteText }} <br />
                  {{ note.postedDate }}
                </app-govuk-inset-text>
              }
            }
          </app-govuk-tab-panel></ng-container
        >
      </app-govuk-tabs>
    </div>
  </div>

  <div class="govuk-grid-row govuk-!-margin-top-6">
    <div class="govuk-grid-column-two-thirds">
      <app-govuk-button
        buttonClasses="govuk-button--secondary govuk-!-margin-right-3"
        buttonId="back"
        (buttonClickEvent)="handleBack()"
      >
        Back</app-govuk-button
      >
      <app-govuk-button
        buttonClasses="govuk-button--warning govuk-!-margin-right-3"
        buttonId="newSearch"
        (buttonClickEvent)="handleNewSearch()"
      >
        New Search</app-govuk-button
      >
    </div>
  </div>
}
