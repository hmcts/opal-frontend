<div class="govuk-!-margin-bottom-7">
  <app-govuk-back-link (clickEvent)="handleBack(manualAccountCreationRoutes.createAccount)"></app-govuk-back-link>
</div>
<h1 class="govuk-heading-l">Personal details</h1>
<app-govuk-error-summary [errors]="formErrorSummaryMessage" (errorClick)="scrollTo($event)"></app-govuk-error-summary>
<form (submit)="handleFormSubmit()" [formGroup]="form">
  <app-govuk-select
    labelText="Title"
    selectId="title"
    selectName="title"
    [options]="titleOptions"
    [control]="form.controls['title']"
    [errors]="formControlErrorMessages['title']"
  ></app-govuk-select>
  <app-govuk-text-input
    labelText="First names"
    inputId="firstNames"
    inputName="firstNames"
    labelClasses="govuk-label--s"
    hintText="This can include their middle names"
    [control]="form.controls['firstNames']"
    [errors]="formControlErrorMessages['firstNames']"
  ></app-govuk-text-input>
  <app-govuk-text-input
    labelText="Last name"
    inputId="lastName"
    inputName="lastName"
    labelClasses="govuk-label--s"
    [control]="form.controls['lastName']"
    [errors]="formControlErrorMessages['lastName']"
  ></app-govuk-text-input>
  <app-govuk-checkboxes fieldSetId="addAlias" checkboxClasses="" legendText="">
    <div
      app-govuk-checkboxes-item
      labelText="Add aliases"
      inputId="addAlias"
      inputName="addAlias"
      [control]="form.get('addAlias')"
    ></div>

    @if (form.get('addAlias')?.value === true) {
      <div app-govuk-checkboxes-conditional conditionalId="addAlias" formArrayName="aliases">
        @for (aliasControl of aliasControls; let rowIndex = $index; track rowIndex) {
          <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">Alias {{ rowIndex + 1 }}</legend>
            <app-govuk-text-input
              labelText="First names"
              [inputId]="aliasControls[rowIndex].firstName.inputId"
              [inputName]="aliasControls[rowIndex].firstName.inputName"
              labelClasses="govuk-label--s"
              [control]="form.get(['aliases', rowIndex, aliasControls[rowIndex].firstName.controlName])"
              [errors]="formControlErrorMessages[aliasControls[rowIndex].firstName.controlName]"
            ></app-govuk-text-input>
            <app-govuk-text-input
              labelText="Last name"
              [inputId]="aliasControls[rowIndex].lastName.inputId"
              [inputName]="aliasControls[rowIndex].lastName.inputName"
              labelClasses="govuk-label--s"
              [control]="form.get(['aliases', rowIndex, aliasControls[rowIndex].lastName.controlName])"
              [errors]="formControlErrorMessages[aliasControls[rowIndex].lastName.controlName]"
            ></app-govuk-text-input>
          </fieldset>
        }

        @if (aliasControls.length > 1) {
          <div class="govuk-!-margin-bottom-3">
            <a
              class="govuk-link govuk-link--no-visited-state"
              (click)="removeAlias(aliasControls.length - 1)"
              (keyup.enter)="removeAlias(aliasControls.length - 1)"
              tabindex="0"
            >
              Remove Alias
            </a>
          </div>
        }
        <app-govuk-button
          buttonId="addAlias"
          buttonClasses="govuk-button--secondary govuk-!-margin-bottom-0"
          type="button"
          (buttonClickEvent)="addAliases(aliasControls.length)"
          >Add Alias</app-govuk-button
        >
      </div>
    }
  </app-govuk-checkboxes>

  <app-scotgov-date-picker
    labelText="Date of birth"
    labelClasses="govuk-label--s"
    inputId="dateOfBirth"
    inputName="dateOfBirth"
    inputClasses="govuk-input--width-10"
    hintText="For example, 31/01/2023"
    [control]="form.controls['dateOfBirth']"
    [maxDate]="today"
  ></app-scotgov-date-picker>
  <app-govuk-text-input
    labelText="National Insurance number"
    inputId="nationalInsuranceNumber"
    inputName="nationalInsuranceNumber"
    inputClasses="govuk-input--width-10"
    labelClasses="govuk-label--s"
    [control]="form.controls['nationalInsuranceNumber']"
    [errors]="formControlErrorMessages['nationalInsuranceNumber']"
  ></app-govuk-text-input>
  <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />
  <fieldset class="govuk-fieldset">
    <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">Address</legend>
    <app-govuk-text-input
      labelText="Address line 1"
      inputId="addressLine1"
      inputName="addressLine1"
      inputClasses="govuk-input--width-8"
      labelClasses="govuk-label--s"
      [control]="form.controls['addressLine1']"
      [errors]="formControlErrorMessages['addressLine1']"
    ></app-govuk-text-input>
    <app-govuk-text-input
      labelText="Address line 2"
      inputId="addressLine2"
      inputName="addressLine2"
      labelClasses="govuk-label--s"
      [control]="form.controls['addressLine2']"
      [errors]="formControlErrorMessages['addressLine2']"
    ></app-govuk-text-input>
    <app-govuk-text-input
      labelText="Address line 3"
      inputId="addressLine3"
      inputName="addressLine3"
      labelClasses="govuk-label--s"
      [control]="form.controls['addressLine3']"
      [errors]="formControlErrorMessages['addressLine3']"
    ></app-govuk-text-input>
    <app-govuk-text-input
      labelText="Postcode"
      inputId="postcode"
      inputName="postcode"
      inputClasses="govuk-input--width-10"
      labelClasses="govuk-label--s"
      [control]="form.controls['postcode']"
      [errors]="formControlErrorMessages['postcode']"
    ></app-govuk-text-input>
  </fieldset>
  <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />
  <h2 class="govuk-heading-m">Vehicle details</h2>
  <app-govuk-text-input
    labelText="Make of the car"
    inputId="makeOfCar"
    inputName="addressLine3"
    labelClasses="govuk-label--s"
    [control]="form.controls['makeOfCar']"
    [errors]="formControlErrorMessages['makeOfCar']"
  ></app-govuk-text-input>
  <app-govuk-text-input
    labelText="Registration number"
    inputId="registrationNumber"
    inputName="registrationNumber"
    inputClasses="govuk-input--width-10"
    labelClasses="govuk-label--s"
    [control]="form.controls['registrationNumber']"
    [errors]="formControlErrorMessages['registrationNumber']"
  ></app-govuk-text-input>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <app-govuk-button buttonId="submitForm" type="submit">Save and return to tasks</app-govuk-button>
    </div>
  </div>
</form>
