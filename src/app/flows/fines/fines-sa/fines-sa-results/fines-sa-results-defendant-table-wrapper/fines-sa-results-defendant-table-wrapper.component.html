<opal-lib-custom-horizontal-scroll-pane>
  <opal-lib-moj-sortable-table>
    <ng-container head>
      <th
        opal-lib-moj-sortable-table-header
        columnKey="Account"
        [sortDirection]="sortStateSignal()['Account']"
        (sortChange)="onSortChange($event)"
        [dataIndex]="0"
      >
        Account
      </th>
      <th
        opal-lib-moj-sortable-table-header
        columnKey="Name"
        [sortDirection]="sortStateSignal()['Name']"
        (sortChange)="onSortChange($event)"
        [dataIndex]="1"
      >
        {{ isCompany ? 'Company' : 'Name' }}
      </th>
      <th
        opal-lib-moj-sortable-table-header
        columnKey="Aliases"
        [sortDirection]="sortStateSignal()['Aliases']"
        (sortChange)="onSortChange($event)"
        [dataIndex]="2"
      >
        Aliases
      </th>
      @if (!isCompany) {
        <th
          opal-lib-moj-sortable-table-header
          columnKey="Date of birth"
          [sortDirection]="sortStateSignal()['Date of birth']"
          (sortChange)="onSortChange($event)"
          [dataIndex]="3"
        >
          Date of birth
        </th>
      }
      <th
        opal-lib-moj-sortable-table-header
        columnKey="Address line 1"
        [sortDirection]="sortStateSignal()['Address line 1']"
        (sortChange)="onSortChange($event)"
        [dataIndex]="isCompany ? 3 : 4"
      >
        Address line 1
      </th>
      <th
        opal-lib-moj-sortable-table-header
        columnKey="Postcode"
        [sortDirection]="sortStateSignal()['Postcode']"
        (sortChange)="onSortChange($event)"
        [dataIndex]="isCompany ? 4 : 5"
      >
        Postcode
      </th>
      @if (!isCompany) {
        <th
          opal-lib-moj-sortable-table-header
          columnKey="NI number"
          [sortDirection]="sortStateSignal()['NI number']"
          (sortChange)="onSortChange($event)"
          [dataIndex]="6"
        >
          NI number
        </th>
        <th
          opal-lib-moj-sortable-table-header
          columnKey="Parent or guardian"
          [sortDirection]="sortStateSignal()['Parent or guardian']"
          (sortChange)="onSortChange($event)"
          [dataIndex]="7"
        >
          Parent or guardian
        </th>
      }
      <th
        opal-lib-moj-sortable-table-header
        columnKey="Business unit"
        [sortDirection]="sortStateSignal()['Business unit']"
        (sortChange)="onSortChange($event)"
        [dataIndex]="isCompany ? 5 : 8"
      >
        Business unit
      </th>
      <th
        opal-lib-moj-sortable-table-header
        columnKey="Ref"
        [sortDirection]="sortStateSignal()['Ref']"
        (sortChange)="onSortChange($event)"
        [dataIndex]="isCompany ? 6 : 9"
      >
        Ref
      </th>
      <th
        opal-lib-moj-sortable-table-header
        columnKey="Enf"
        [sortDirection]="sortStateSignal()['Enf']"
        (sortChange)="onSortChange($event)"
        [dataIndex]="isCompany ? 7 : 10"
      >
        ENF
      </th>
      <th
        opal-lib-moj-sortable-table-header
        columnKey="Balance"
        [sortDirection]="sortStateSignal()['Balance']"
        (sortChange)="onSortChange($event)"
        [dataIndex]="isCompany ? 8 : 11"
      >
        Balance
      </th>
    </ng-container>
    <ng-container row>
      @for (row of paginatedTableDataComputed(); track row['Account']) {
        <tr opal-lib-moj-sortable-table-row>
          <td opal-lib-moj-sortable-table-row-data id="accountNumber">
            <app-fines-sa-results-shared-table-cell [value]="row['Account']">
              @if (row['Account ID']) {
                <a
                  class="govuk-link govuk-link--no-visited-state"
                  tabindex="0"
                  (click)="goToAccount(row['Account ID'])"
                  (keyup.enter)="goToAccount(row['Account ID'])"
                  >{{ row['Account']! }}</a
                >
              } @else {
                {{ row['Account'] }}
              }
            </app-fines-sa-results-shared-table-cell>
          </td>
          <td opal-lib-moj-sortable-table-row-data id="name">
            <app-fines-sa-results-shared-table-cell [value]="row['Name']">
              {{ row['Name'] }}
            </app-fines-sa-results-shared-table-cell>
          </td>
          <td opal-lib-moj-sortable-table-row-data id="aliases">
            <app-fines-sa-results-shared-table-cell [value]="row['Aliases']">
              {{ row['Aliases'] }}
            </app-fines-sa-results-shared-table-cell>
          </td>
          @if (!isCompany) {
            <td opal-lib-moj-sortable-table-row-data id="dateOfBirth">
              <app-fines-sa-results-shared-table-cell [value]="row['Date of birth']">
                {{ row['Date of birth'] | dateFormat: DATE_INPUT_FORMAT : DATE_OUTPUT_FORMAT }}
              </app-fines-sa-results-shared-table-cell>
            </td>
          }
          <td opal-lib-moj-sortable-table-row-data id="defendantAddressLine1">
            <app-fines-sa-results-shared-table-cell class="defendantAddressLine1" [value]="row['Address line 1']">
              {{ row['Address line 1'] }}
            </app-fines-sa-results-shared-table-cell>
          </td>
          <td opal-lib-moj-sortable-table-row-data id="defendantPostcode">
            <app-fines-sa-results-shared-table-cell class="defendantPostcode" [value]="row['Postcode']">
              {{ row['Postcode'] }}
            </app-fines-sa-results-shared-table-cell>
          </td>
          @if (!isCompany) {
            <td opal-lib-moj-sortable-table-row-data id="nationalInsuranceNumber">
              <app-fines-sa-results-shared-table-cell [value]="row['NI number']">
                {{ row['NI number'] | nationalInsurance }}
              </app-fines-sa-results-shared-table-cell>
            </td>
            <td opal-lib-moj-sortable-table-row-data id="parentOrGuardian">
              <app-fines-sa-results-shared-table-cell [value]="row['Parent or guardian']">
                {{ row['Parent or guardian'] }}
              </app-fines-sa-results-shared-table-cell>
            </td>
          }
          <td opal-lib-moj-sortable-table-row-data id="businessUnit">
            <app-fines-sa-results-shared-table-cell [value]="row['Business unit']">
              {{ row['Business unit'] }}
            </app-fines-sa-results-shared-table-cell>
          </td>
          <td opal-lib-moj-sortable-table-row-data id="ref">
            <app-fines-sa-results-shared-table-cell [value]="row['Ref']">
              {{ row['Ref'] }}
            </app-fines-sa-results-shared-table-cell>
          </td>
          <td opal-lib-moj-sortable-table-row-data id="enf">
            <app-fines-sa-results-shared-table-cell [value]="row['Enf']">
              {{ row['Enf'] | uppercase }}
            </app-fines-sa-results-shared-table-cell>
          </td>
          <td opal-lib-moj-sortable-table-row-data id="balance">
            <app-fines-sa-results-shared-table-cell [value]="row['Balance']">
              {{ row['Balance'] | currency: 'GBP' }}
            </app-fines-sa-results-shared-table-cell>
          </td>
        </tr>
      }
    </ng-container>
    <app-fines-sa-results-shared-table-status
      [columnTitle]="sortedColumnTitleSignal()"
      [sortDirection]="sortedColumnDirectionSignal()"
    />
  </opal-lib-moj-sortable-table>
</opal-lib-custom-horizontal-scroll-pane>

<app-fines-sa-results-shared-pagination
  paginationId="fines-defendant-table-pagination"
  [currentPage]="currentPageSignal()"
  [itemsPerPage]="itemsPerPageSignal()"
  [totalItems]="filteredTableDataSignal().length"
  [currentPageItems]="paginatedTableDataComputed().length"
  (changePage)="onPageChange($event)"
></app-fines-sa-results-shared-pagination>
