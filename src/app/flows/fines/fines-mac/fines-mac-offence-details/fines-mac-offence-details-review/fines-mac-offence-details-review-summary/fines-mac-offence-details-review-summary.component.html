<div class="govuk-grid-column-full">
  <h1 class="govuk-heading-l">Offences and impositions</h1>
  @if (offencesImpositions.length === 0) {
    <ng-container *ngTemplateOutlet="emptyOffences"></ng-container>
  } @else {
    <ng-container *ngTemplateOutlet="populatedOffences"></ng-container>
  }
</div>

<ng-template #emptyOffences>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <p>There are no offences.</p>
    </div>
  </div>
  <hr />
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <app-govuk-button
        buttonId="addAnOffence"
        buttonClasses="govuk-button--secondary"
        (buttonClickEvent)="handleRoute(fineMacOffenceDetailsRoutingPaths.children.addOffence)"
      >
        Add an offence
      </app-govuk-button>
    </div>
  </div>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <app-govuk-button
        buttonId="returnToCreateAccount"
        (buttonClickEvent)="handleRoute(finesMacRoutingPaths.children.accountDetails, true)"
      >
        Return to account details
      </app-govuk-button>
    </div>
  </div>
</ng-template>

<ng-template #populatedOffences>
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      @for (offence of offencesImpositions; track offence.formData.fm_offence_details_index) {
        @if (offence.formData.fm_offence_details_date_of_offence) {
          <app-fines-mac-offence-details-review-summary-date-of-sentence
            [dateOfSentence]="offence.formData.fm_offence_details_date_of_offence"
          ></app-fines-mac-offence-details-review-summary-date-of-sentence>
        }
        @if (offenceRefData$ | async; as offenceRefData) {
          @if (offence.formData.fm_offence_details_offence_code) {
            <app-fines-mac-offence-details-review-summary-offence-title
              [offenceCode]="offence.formData.fm_offence_details_offence_code"
              [offenceRefData]="offenceRefData"
            ></app-fines-mac-offence-details-review-summary-offence-title>
          }
        }
        <app-fines-mac-offence-details-review-summary-imposition-table
          [impositionRefData]="impositionRefData"
          [majorCreditorRefData]="majorCreditorRefData"
          [impositions]="offence.formData.fm_offence_details_impositions"
        >
        </app-fines-mac-offence-details-review-summary-imposition-table>
      }
    </div>
    <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible govuk-!-margin-top-2" />
    <div class="govuk-grid-column-full">
      <app-govuk-button
        buttonId="addAnOffence"
        buttonClasses="govuk-button--secondary"
        (buttonClickEvent)="handleRoute(fineMacOffenceDetailsRoutingPaths.children.addOffence)"
      >
        Add another offence
      </app-govuk-button>
    </div>
    <div class="govuk-grid-column-full">
      <div class="border-bottom">
        <h1 class="govuk-heading-m">Totals</h1>
      </div>
    </div>
    <div class="govuk-grid-column-two-thirds">
      <app-fines-mac-offence-details-review-summary-offences-total
        [offences]="offencesImpositions"
      ></app-fines-mac-offence-details-review-summary-offences-total>
    </div>
    <div class="govuk-grid-column-full">
      <app-govuk-button
        buttonId="returnToCreateAccount"
        (buttonClickEvent)="handleRoute(finesMacRoutingPaths.children.accountDetails)"
      >
        Return to account details
      </app-govuk-button>
      <app-govuk-button
        buttonId="submitForm"
        buttonClasses="nested-flow govuk-button--secondary govuk-!-margin-left-3"
        (buttonClickEvent)="handleRoute(finesMacRoutingPaths.children.paymentTerms, true)"
      >
        Add payment terms
      </app-govuk-button>
    </div>
    <div class="govuk-grid-column-full">
      <app-govuk-cancel-link
        (linkClickEvent)="handleRoute(finesMacRoutingPaths.children.accountDetails, true)"
      ></app-govuk-cancel-link>
    </div>
  </div>
</ng-template>
