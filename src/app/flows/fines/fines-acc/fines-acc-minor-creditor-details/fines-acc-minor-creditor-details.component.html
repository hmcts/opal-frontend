@if (accountStore.hasVersionMismatch()) {
  <div class="govuk-grid-column-full">
    <opal-lib-moj-alert type="warning" ariaLabel="offenceCodeMessage">
      <opal-lib-moj-alert-icon icon type="warning"></opal-lib-moj-alert-icon>
      <opal-lib-moj-alert-content content>
        <opal-lib-moj-alert-content-text
          >Some information on this page may be out of date.
          <a tabindex="0" (click)="refreshPage()" (keyup.enter)="refreshPage()"
            >Refresh</a
          ></opal-lib-moj-alert-content-text
        >
      </opal-lib-moj-alert-content>
    </opal-lib-moj-alert>
  </div>
} @else if (accountStore.successMessage()) {
  <div class="govuk-grid-column-full">
    <opal-lib-moj-alert
      type="success"
      ariaLabel="offenceCodeMessage"
      [showDismiss]="true"
      (dismissed)="accountStore.clearSuccessMessage()"
    >
      <opal-lib-moj-alert-icon icon type="success"></opal-lib-moj-alert-icon>
      <opal-lib-moj-alert-content content>
        <opal-lib-moj-alert-content-text>{{ accountStore.successMessage() }}</opal-lib-moj-alert-content-text>
      </opal-lib-moj-alert-content>
    </opal-lib-moj-alert>
  </div>
}
<div class="govuk-grid-column-full">
  <opal-lib-custom-page-header>
    <ng-container pageHeaderHeading>
      <opal-lib-govuk-heading-with-caption
        [captionText]="accountData.account_number"
        headingText="{{ accountStore.party_name() }}"
      ></opal-lib-govuk-heading-with-caption>
    </ng-container>
    <ng-container pageHeaderButtons>
      @if (hasPermission('add-account-activity-notes')) {
        <button
          opalLibGovukButton
          buttonId="addAccountNote"
          buttonClasses="govuk-button--secondary"
          (click)="navigateToAddAccountNotePage()"
        >
          Add account note
        </button>
      }

      <opal-lib-moj-button-menu menuButtonTitle="More options:"></opal-lib-moj-button-menu>
    </ng-container>
  </opal-lib-custom-page-header>
</div>

<div class="govuk-grid-column-three-quarters">
  <opal-lib-custom-account-information>
    <opal-lib-custom-account-information-item itemClasses="govuk-grid-column-one-quarter">
      <h2 opal-lib-custom-account-information-item-label>Account type:</h2>
      <p opal-lib-custom-account-information-item-value>{{ accountData.creditor_account_type.display_name }}</p>
    </opal-lib-custom-account-information-item>
    <opal-lib-custom-account-information-item itemClasses="govuk-grid-column-one-quarter">
      <h2 opal-lib-custom-account-information-item-label>Business Unit:</h2>
      <p opal-lib-custom-account-information-item-value>
        {{ accountData.business_unit_summary.business_unit_name }} ({{
          accountData.business_unit_summary.business_unit_id
        }})
      </p>
    </opal-lib-custom-account-information-item>
  </opal-lib-custom-account-information>
</div>

<div class="govuk-grid-column-full">
  <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-3 govuk-!-margin-top-2" />

  <opal-lib-custom-summary-metric-bar>
    <opal-lib-custom-summary-metric-bar-item>
      <p opal-lib-custom-summary-metric-bar-item-label>Awarded:</p>
      <p opal-lib-custom-summary-metric-bar-item-value>
        {{ accountData.awarded_amount | monetary }}
      </p>
    </opal-lib-custom-summary-metric-bar-item>
    <opal-lib-custom-summary-metric-bar-item backgroundColour="govuk-lighter-blue-background-colour">
      <p opal-lib-custom-summary-metric-bar-item-label textColour="govuk-dark-blue-text-colour">Paid out:</p>
      <p opal-lib-custom-summary-metric-bar-item-value textColour="govuk-dark-blue-text-colour">
        {{ accountData.paid_out_amount | monetary }}
      </p>
    </opal-lib-custom-summary-metric-bar-item>
    <opal-lib-custom-summary-metric-bar-item backgroundColour="govuk-lighter-blue-background-colour">
      <p opal-lib-custom-summary-metric-bar-item-label textColour="govuk-dark-blue-text-colour">Awaiting payout:</p>
      <p opal-lib-custom-summary-metric-bar-item-value textColour="govuk-dark-blue-text-colour">
        {{ accountData.awaiting_payout_amount | monetary }}
      </p>
    </opal-lib-custom-summary-metric-bar-item>
    <opal-lib-custom-summary-metric-bar-item backgroundColour="govuk-blue-background-colour">
      <p opal-lib-custom-summary-metric-bar-item-label textColour="govuk-white-text-colour">Outstanding:</p>
      <p opal-lib-custom-summary-metric-bar-item-value textColour="govuk-white-text-colour">
        {{ accountData.outstanding_amount | monetary }}
      </p>
    </opal-lib-custom-summary-metric-bar-item>
  </opal-lib-custom-summary-metric-bar>
</div>

<div class="govuk-grid-column-full govuk-!-padding-top-2">
  <opal-lib-moj-sub-navigation subNavId="account-details-tabs" (activeSubNavItemFragment)="handleTabSwitch($event)">
    <li
      opal-lib-moj-sub-navigation-item
      subNavItemId="at-a-glance-tab"
      [activeSubNavItemFragment]="activeTab"
      subNavItemFragment="at-a-glance"
      [subNavItemText]="tabs['at-a-glance']"
    ></li>
  </opal-lib-moj-sub-navigation>
</div>
